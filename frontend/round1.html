<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Round 1 Assessment | TOTAL/100 SCORING READY</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Brand Colors & Tailwind Config -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'brand-primary': '#6366f1',
            'brand-primary-hover': '#4f46e5',
            'brand-accent': '#7c3aed',
            'brand-accent-hover': '#6d28d9',
          },
          fontFamily: {
            sans: ['Inter', 'ui-sans-serif', 'system-ui', 'sans-serif'],
          },
          boxShadow: {
            'xl-soft': '0 20px 25px -5px rgba(99,102,241,0.15), 0 10px 10px -5px rgba(124,58,237,0.1)',
          },
          transitionProperty: {
            'width': 'width',
            'spacing': 'margin, padding',
            'colors': 'background-color, border-color, color, fill, stroke',
          }
        },
      },
    }
  </script>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />

  <style>
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }
    #progressBar {
      animation: pulse 2s infinite;
    }
    .fade-in {
      animation: fadeIn 1.2s ease forwards;
      opacity: 0;
    }
    @keyframes fadeIn {
      to {
        opacity: 1;
      }
    }
  </style>
</head>

<body class="bg-gradient-to-br from-indigo-100 via-white to-purple-100 min-h-screen flex items-center justify-center p-8 font-sans">
  <div class="max-w-7xl w-full grid grid-cols-1 lg:grid-cols-3 gap-12">

    <!-- Left: Assessment Form -->
    <div class="lg:col-span-2 bg-white/90 backdrop-blur-lg rounded-3xl shadow-xl-soft border border-gray-200 p-10 md:p-16 transition-shadow duration-300 hover:shadow-2xl">
      <!-- Header -->
      <div class="flex items-center justify-between mb-10 select-none">
        <span id="stepText" class="text-sm font-semibold text-gray-500 uppercase tracking-widest"></span>
        <div class="w-1/3 h-2 bg-gray-200 rounded-full overflow-hidden shadow-inner">
          <div id="progressBar" class="h-2 bg-gradient-to-r from-brand-primary to-brand-accent rounded-full transition-width duration-500 ease-in-out"></div>
        </div>
      </div>

      <!-- Question -->
      <h2 id="questionText" class="text-4xl font-extrabold text-gray-900 mb-14 leading-tight tracking-tight transition-opacity duration-300"></h2>

      <!-- Options -->
      <form id="questionForm" class="space-y-8">
        <div id="optionsContainer" class="space-y-6"></div>

        <!-- Navigation Buttons -->
        <div class="flex justify-between items-center mt-16">
          <button type="button" id="backBtn" class="text-gray-600 font-semibold hover:text-gray-900 disabled:opacity-30 transition-colors duration-300 px-6 py-3 rounded-lg select-none flex items-center gap-2">
            <span class="text-2xl leading-none">‚¨ÖÔ∏è</span> Back
          </button>
          <button type="submit" id="nextBtn" class="bg-gradient-to-r from-brand-primary to-brand-accent text-white px-14 py-4 rounded-2xl font-bold shadow-lg hover:from-brand-accent-hover hover:to-brand-primary-hover transition-all duration-300 transform hover:-translate-y-1 select-none focus:ring-4 focus:ring-brand-primary/50 active:scale-95 disabled:opacity-50 disabled:transform-none">
            Continue ‚û°Ô∏è
          </button>
        </div>
      </form>
    </div>

    <!-- Right: Tips & Quotes -->
    <aside class="hidden lg:flex flex-col bg-white/70 backdrop-blur-lg rounded-3xl shadow-xl-soft border border-gray-200 p-8 sticky top-16 max-h-[80vh] overflow-y-auto">
      <!-- Quote -->
      <div class="mb-10 flex-grow flex flex-col justify-center items-center px-6 text-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-indigo-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M7.17 8A3.001 3.001 0 008 15h0a3 3 0 002.83-4H7.17zM4.5 12a4.5 4.5 0 014.5-4.5M19.5 12a4.5 4.5 0 00-4.5-4.5" />
        </svg>
        <p id="healthQuote" class="text-xl italic font-semibold text-indigo-700 leading-relaxed fade-in"></p>
      </div>

      <!-- Wellness Tips -->
      <div>
        <h3 class="text-2xl font-extrabold text-indigo-800 mb-6 border-b border-indigo-300 pb-2">Round 1 of 2 ‚úÖ</h3>
        <ul class="space-y-5 text-indigo-700 text-lg">
          <li class="flex items-start gap-4"><span class="text-3xl animate-bounce mt-1">üì±</span><span>Saved locally - no backend call</span></li>
          <li class="flex items-start gap-4"><span class="text-3xl animate-bounce delay-150 mt-1">‚ö°</span><span>Max 50 points (higher = more stress)</span></li>
          <li class="flex items-start gap-4"><span class="text-3xl animate-bounce delay-300 mt-1">‚ûï</span><span>Combines with Round 2 = TOTAL/100</span></li>
          <li class="flex items-start gap-4"><span class="text-3xl animate-bounce delay-450 mt-1">üéØ</span><span>Backend calculates at Round 2 finish</span></li>
        </ul>
      </div>

      <footer class="mt-auto text-center text-sm text-indigo-600 opacity-70 mt-10 px-4">
        üíö Next: Round 2 ‚Üí TOTAL/100 Results!
      </footer>
    </aside>
  </div>

  <script>
    // AUTH CHECK - REDIRECT IF NOT LOGGED IN
    if (!localStorage.getItem('mindwellToken')) {
      alert('Please login first');
      window.location.href = 'login.html';
    }

    /* ---------------- QUESTIONS ---------------- */
    const questions = [
      { id: 'q1', text: 'üõå How often do you wake up feeling low?', type: 'scale', labels: {1: 'Never', 5: 'Always'} },
      { id: 'q2', text: 'üò¥ Hours of sleep per night?', type: 'number', min: 0, max: 12 },
      { id: 'q3', text: 'üé® Lose interest in hobbies?', type: 'scale', labels: {1: 'Never', 5: 'Always'} },
      { id: 'q4', text: 'üìö Stay focused?', type: 'scale', labels: {1: 'Never', 5: 'Always'} },
      { id: 'q5', text: 'ü§ù Feel supported?', type: 'select', options: ['Yes, definitely', 'Somewhat', 'No, not really'] },
      { id: 'q6', text: '‚ö° Tasks overwhelming?', type: 'scale', labels: {1: 'Never', 5: 'Always'} },
      { id: 'q7', text: 'üçΩÔ∏è Appetite change?', type: 'select', options: ['Normal', 'Poor', 'Overeating'] },
      { id: 'q8', text: 'üîã Feel tired?', type: 'select', options: ['Rarely', 'Sometimes', 'Often', 'Constantly'] },
      { id: 'q9', text: 'üèÉ Weekly activity?', type: 'select', options: ['Daily', '3-4 times/week', '1-2 times/week', 'Rarely'] },
      { id: 'q10', text: 'üß† Mental health today?', type: 'scale', labels: {1: 'Very poor', 5: 'Excellent'} },
    ];

    /* ---------------- STATE ---------------- */
    let currentStep = 0;
    let answers = {};

    /* ---------------- DOM ---------------- */
    const questionText = document.getElementById("questionText");
    const optionsContainer = document.getElementById("optionsContainer");
    const stepText = document.getElementById("stepText");
    const progressBar = document.getElementById("progressBar");
    const backBtn = document.getElementById("backBtn");
    const form = document.getElementById("questionForm");
    const healthQuote = document.getElementById("healthQuote");
    const nextBtn = document.getElementById("nextBtn");

    /* ---------------- QUOTES ---------------- */
    const quotes = [
      "Your mental health matters just as much as your physical health.",
      "Healing is not linear ‚Äî be kind to yourself.",
      "Small steps every day lead to meaningful change.",
      "It's okay to slow down. You are not falling behind.",
      "Taking care of your mind is a form of strength."
    ];

    function showRandomQuote() {
      const randomIndex = Math.floor(Math.random() * quotes.length);
      healthQuote.innerText = `"${quotes[randomIndex]}"`;
      healthQuote.classList.remove("fade-in");
      void healthQuote.offsetWidth;
      healthQuote.classList.add("fade-in");
    }

    /* ---------------- RENDER ---------------- */
    function renderQuestion() {
      const q = questions[currentStep];
      stepText.innerText = `Question ${currentStep + 1} / ${questions.length}`;
      const progress = ((currentStep + 1) / questions.length) * 100;
      progressBar.style.width = progress + "%";

      questionText.classList.add("opacity-0");
      setTimeout(() => {
        questionText.innerText = q.text;
        questionText.classList.remove("opacity-0");
      }, 200);

      optionsContainer.innerHTML = "";
      backBtn.disabled = currentStep === 0;
      nextBtn.disabled = false;
      nextBtn.innerText = currentStep === questions.length - 1 ? "‚úÖ Finish Round 1" : "Continue ‚û°Ô∏è";

      // Scale (1-5)
      if (q.type === "scale") {
        for (let i = 1; i <= 5; i++) {
          const selected = answers[q.id] == i;
          optionsContainer.innerHTML += `
            <label class="group block border-2 p-6 rounded-3xl cursor-pointer transition-all mb-6 ${selected ? 'bg-gradient-to-r from-brand-primary to-brand-accent text-white shadow-xl scale-[1.05]' : 'bg-white border-gray-200 hover:border-brand-primary/60 hover:scale-[1.03] hover:shadow-md'}">
              <div class="flex items-center">
                <input type="radio" name="${q.id}" hidden value="${i}" ${selected ? 'checked' : ''} />
                <div class="w-10 h-10 rounded-full border-2 flex items-center justify-center ${selected ? 'border-white' : 'border-gray-300'}">
                  ${selected ? '<div class="w-5 h-5 bg-white rounded-full"></div>' : ''}
                </div>
                <div class="ml-6">
                  <span class="block font-extrabold text-2xl">${i}</span>
                  <span class="text-sm opacity-90">${q.labels?.[i] || (i === 1 ? 'Never / Very Low' : i === 5 ? 'Always / Very High' : '')}</span>
                </div>
              </div>
            </label>
          `;
        }
      }

      // Select options
      if (q.type === "select") {
        q.options.forEach(opt => {
          const selected = answers[q.id] === opt;
          optionsContainer.innerHTML += `
            <label class="group block border-2 p-6 rounded-3xl cursor-pointer transition-all mb-6 ${selected ? 'bg-gradient-to-r from-brand-primary to-brand-accent text-white shadow-xl scale-[1.05]' : 'bg-white border-gray-200 hover:border-brand-primary/60 hover:scale-[1.03] hover:shadow-md'}">
              <div class="flex items-center">
                <input type="radio" name="${q.id}" hidden value="${opt}" ${selected ? 'checked' : ''} />
                <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center ${selected ? 'border-white' : 'border-gray-300'}">
                  ${selected ? '<div class="w-4 h-4 bg-white rounded-full"></div>' : ''}
                </div>
                <span class="ml-6 font-extrabold text-xl">${opt}</span>
              </div>
            </label>
          `;
        });
      }

      // Number input
      if (q.type === "number") {
        optionsContainer.innerHTML = `
          <input type="number" min="${q.min}" max="${q.max}" required value="${answers[q.id] || ''}" id="numberInput" placeholder="Enter hours (0-12)..." class="block w-full border-2 border-gray-300 rounded-3xl p-8 text-2xl focus:ring-brand-primary focus:border-brand-primary outline-none transition-all hover:shadow-md text-center" />
        `;
      }

      showRandomQuote();
    }

    /* ---------------- EVENTS ---------------- */
    // Option selection handler
    optionsContainer.addEventListener("click", e => {
      const label = e.target.closest("label");
      if (!label) return;
      const input = label.querySelector("input");
      if (!input) return;
      answers[questions[currentStep].id] = input.value;
      renderQuestion();
    });

    // Number input handler
    optionsContainer.addEventListener("input", e => {
      if (e.target.id === "numberInput") {
        answers[questions[currentStep].id] = e.target.value;
      }
    });

    // Back button
    backBtn.addEventListener("click", () => {
      if (currentStep > 0) {
        currentStep--;
        renderQuestion();
      }
    });

    // üî• FIXED SUBMIT - LOCALSTORAGE ONLY (NO BACKEND CALL!)
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      
      console.log('üîç ROUND1 ANSWERS:', answers);

      if (currentStep < questions.length - 1) {
        currentStep++;
        renderQuestion();
        return;
      }

      // ‚úÖ NO BACKEND CALL - JUST LOCALSTORAGE
      nextBtn.disabled = true;
      nextBtn.innerText = "üíæ Saving Locally...";

      // Simulate save delay
      setTimeout(() => {
        // SAVE TO LOCALSTORAGE FOR ROUND2
        localStorage.setItem("round1Result", JSON.stringify({ 
          answers: answers
        }));
        console.log('üíæ ROUND1 SAVED TO LOCALSTORAGE (10 questions ready for TOTAL/100)');
        
        nextBtn.innerText = "‚úÖ Saved! Going to Round 2...";
        
        // SMOOTH REDIRECT TO ROUND2
        setTimeout(() => {
          window.location.href = "round2.html";
        }, 1000);
        
      }, 1200);

      nextBtn.disabled = false;
    });

    /* ---------------- INIT ---------------- */
    renderQuestion();
  </script>
</body>
</html>
